<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ceteris Paribus Plots for classification • ceterisParibus</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top navbar-mi2" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-mi2logo" href="http://mi2.mini.pw.edu.pl/">
        <img src="https://github.com/mi2-warsaw/MI2template/blob/master/inst/pkgdown/assets/MI2logo.jpg?raw=true" alt="MI2" height="46" title="MI2"></a>
      <a class="navbar-brand navbar-mi2" href="../index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="navbar-mi2 nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ceteris_paribus.html">Ceteris Paribus Plots</a>
    </li>
    <li>
      <a href="../articles/ceteris_paribus_HR.html">Ceteris Paribus Plots for classification</a>
    </li>
    <li>
      <a href="../articles/coral.html">Local Fit Plots / Wangkardu Explanations</a>
    </li>
    <li>
      <a href="../articles/whatIf1d.html">What If Plots</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Ceteris Paribus Plots for classification</h1>
                        <h4 class="author">Przemyslaw Biecek</h4>
            
            <h4 class="date">2018-08-11</h4>
      
      
      <div class="hidden name"><code>ceteris_paribus_HR.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>Here we present an example for classification. The <code>status</code> variable in the <code>HR</code> dataset is a factor that takes three values <code>fired</code>/<code>ok</code>/<code>promoted</code>. We will create a model for this variable and then we present explainers for this model.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(<span class="st">"DALEX"</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">head</span>(HR)</a></code></pre></div>
<pre><code>##   gender      age    hours evaluation salary   status
## 1   male 32.58267 41.88626          3      1    fired
## 2 female 41.21104 36.34339          2      5    fired
## 3   male 37.70516 36.81718          3      0    fired
## 4 female 30.06051 38.96032          3      2    fired
## 5   male 21.10283 62.15464          5      3 promoted
## 6   male 40.11812 69.53973          2      0    fired</code></pre>
<p>Here we create a random forest model for this dataset.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">library</span>(<span class="st">"randomForest"</span>)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw">library</span>(<span class="st">"ceterisParibus"</span>)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="kw">set.seed</span>(<span class="dv">59</span>)</a>
<a class="sourceLine" id="cb3-4" data-line-number="4"></a>
<a class="sourceLine" id="cb3-5" data-line-number="5">model &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/randomForest/topics/randomForest">randomForest</a></span>(status <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>hours <span class="op">+</span><span class="st"> </span>evaluation <span class="op">+</span><span class="st"> </span>salary, <span class="dt">data =</span> HR)</a></code></pre></div>
<p>By default the <code><a href="http://www.rdocumentation.org/packages/randomForest/topics/predict.randomForest">predict.randomForest()</a></code> function returns classes not scores. This is why we use user-specific <code>predict()</code> function. Here we use two explainers, one will explainer the <code>fired</code> class while the second will take care about the <code>promoted</code> class.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">pred1 &lt;-<span class="st"> </span><span class="cf">function</span>(m, x)   <span class="kw">predict</span>(m, x, <span class="dt">type =</span> <span class="st">"prob"</span>)[,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">pred2 &lt;-<span class="st"> </span><span class="cf">function</span>(m, x)   <span class="kw">predict</span>(m, x, <span class="dt">type =</span> <span class="st">"prob"</span>)[,<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">pred3 &lt;-<span class="st"> </span><span class="cf">function</span>(m, x)   <span class="kw">predict</span>(m, x, <span class="dt">type =</span> <span class="st">"prob"</span>)[,<span class="dv">3</span>]</a>
<a class="sourceLine" id="cb4-4" data-line-number="4"></a>
<a class="sourceLine" id="cb4-5" data-line-number="5">explainer_rf_fired &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/DALEX/topics/explain">explain</a></span>(model, <span class="dt">data =</span> HR[,<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>], </a>
<a class="sourceLine" id="cb4-6" data-line-number="6">                              <span class="dt">y =</span> HR<span class="op">$</span>status <span class="op">==</span><span class="st"> "fired"</span>, </a>
<a class="sourceLine" id="cb4-7" data-line-number="7">                              <span class="dt">predict_function =</span> pred1, <span class="dt">label =</span> <span class="st">"fired"</span>)</a>
<a class="sourceLine" id="cb4-8" data-line-number="8">explainer_rf_ok &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/DALEX/topics/explain">explain</a></span>(model, <span class="dt">data =</span> HR[,<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>], </a>
<a class="sourceLine" id="cb4-9" data-line-number="9">                              <span class="dt">y =</span> HR<span class="op">$</span>status <span class="op">==</span><span class="st"> "ok"</span>, </a>
<a class="sourceLine" id="cb4-10" data-line-number="10">                              <span class="dt">predict_function =</span> pred2, <span class="dt">label =</span> <span class="st">"ok"</span>)</a>
<a class="sourceLine" id="cb4-11" data-line-number="11">explainer_rf_promoted &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/DALEX/topics/explain">explain</a></span>(model, <span class="dt">data =</span> HR[,<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>], </a>
<a class="sourceLine" id="cb4-12" data-line-number="12">                               <span class="dt">y =</span> HR<span class="op">$</span>status <span class="op">==</span><span class="st"> "promoted"</span>, </a>
<a class="sourceLine" id="cb4-13" data-line-number="13">                               <span class="dt">predict_function =</span> pred3, <span class="dt">label =</span> <span class="st">"promoted"</span>)</a></code></pre></div>
</div>
<div id="multiclass" class="section level1">
<h1 class="hasAnchor">
<a href="#multiclass" class="anchor"></a>Multiclass</h1>
<p>Ceteris Paribus package can plot many explainers in a single panel. This will be useful for multiclass classification. You can simply create an explainer for each class and plot all these explainers together.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">cp_rf1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ceteris_paribus.html">ceteris_paribus</a></span>(explainer_rf_fired, HR[<span class="dv">1</span>,])</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">cp_rf2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ceteris_paribus.html">ceteris_paribus</a></span>(explainer_rf_ok, HR[<span class="dv">1</span>,])</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">cp_rf3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ceteris_paribus.html">ceteris_paribus</a></span>(explainer_rf_promoted, HR[<span class="dv">1</span>,])</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="kw">plot</span>(cp_rf1, cp_rf2, cp_rf3, </a>
<a class="sourceLine" id="cb5-6" data-line-number="6">     <span class="dt">alpha =</span> <span class="fl">0.5</span>, <span class="dt">color=</span><span class="st">"_label_"</span>, <span class="dt">size_points =</span> <span class="dv">4</span>)</a></code></pre></div>
<p><img src="ceteris_paribus_HR_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
<div id="individial-curves" class="section level1">
<h1 class="hasAnchor">
<a href="#individial-curves" class="anchor"></a>Individial curves</h1>
<p>The <code>explainer_rf_fired</code> explainer is focused on class <code>fired</code>. Let’s see Ceteris Paribus profiles for first 10 individuals.</p>
<p>They are colored with the <code>gender</code> variable. It’s useful since in the model there is an interaction between age and gender. Can you spot it?</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">cp_rf_fired &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ceteris_paribus.html">ceteris_paribus</a></span>(explainer_rf_fired, HR[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,])</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="kw">plot</span>(cp_rf_fired, <span class="dt">color =</span> <span class="st">"gender"</span>)</a></code></pre></div>
<p><img src="ceteris_paribus_HR_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
<div id="partial-dependency-plots" class="section level1">
<h1 class="hasAnchor">
<a href="#partial-dependency-plots" class="anchor"></a>Partial Dependency Plots</h1>
<p>We can plot explainers for two classes (fired and promoted) in the same plot. Here is an example how to do this.</p>
<p>The <code>hours</code> variable is an interesting one. People with low average working hours are on average more likely to be fired not promoted. Also the <code>salary</code> seems to be related with probability of being <code>fired</code> but not <code>promoted</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">cp_rf1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ceteris_paribus.html">ceteris_paribus</a></span>(explainer_rf_fired, HR[<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>,])</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">cp_rf2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ceteris_paribus.html">ceteris_paribus</a></span>(explainer_rf_ok, HR[<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>,])</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">cp_rf3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ceteris_paribus.html">ceteris_paribus</a></span>(explainer_rf_promoted, HR[<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>,])</a>
<a class="sourceLine" id="cb7-4" data-line-number="4"></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="kw">plot</span>(cp_rf1, cp_rf2, cp_rf3, </a>
<a class="sourceLine" id="cb7-6" data-line-number="6">     <span class="dt">aggregate_profiles =</span> mean, </a>
<a class="sourceLine" id="cb7-7" data-line-number="7">     <span class="dt">alpha =</span> <span class="dv">1</span>, <span class="dt">show_observations =</span> <span class="ot">FALSE</span>, <span class="dt">color=</span><span class="st">"_label_"</span>)</a></code></pre></div>
<p><img src="ceteris_paribus_HR_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
<div id="partial-dependency-plots-for-groups-of-obervations" class="section level1">
<h1 class="hasAnchor">
<a href="#partial-dependency-plots-for-groups-of-obervations" class="anchor"></a>Partial Dependency Plots for groups of obervations</h1>
<p>Here we will compare the explainer (probability of being fired) across two genders. We know that there is an interaction between <code>gender</code> and <code>age</code> variables. It will be easy to read this interaction from the plot.</p>
<p>In the plot below we will see that both genders behave in all panels except age. For the <code>age</code> variable it looks like younger woman are more likely to be fired while for males the older age is a risk factor.</p>
<p>Is it because employers are afraid of maternity leaves? Maybe, but please note, that this dataset is an artificial/simulated one.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">cp_rfF &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ceteris_paribus.html">ceteris_paribus</a></span>(explainer_rf_fired, </a>
<a class="sourceLine" id="cb8-2" data-line-number="2">                          HR[<span class="kw">which</span>(HR<span class="op">$</span>gender <span class="op">==</span><span class="st"> "female"</span>)[<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>],])</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">cp_rfF<span class="op">$</span><span class="st">`</span><span class="dt">_label_</span><span class="st">`</span> =<span class="st"> "Fired Female"</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4">cp_rfM &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ceteris_paribus.html">ceteris_paribus</a></span>(explainer_rf_fired, </a>
<a class="sourceLine" id="cb8-5" data-line-number="5">                          HR[<span class="kw">which</span>(HR<span class="op">$</span>gender <span class="op">==</span><span class="st"> "male"</span>)[<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>],])</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">cp_rfM<span class="op">$</span><span class="st">`</span><span class="dt">_label_</span><span class="st">`</span> =<span class="st"> "Fired Male"</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="kw">plot</span>(cp_rfM, cp_rfF, </a>
<a class="sourceLine" id="cb8-9" data-line-number="9">     <span class="dt">aggregate_profiles =</span> mean, </a>
<a class="sourceLine" id="cb8-10" data-line-number="10">     <span class="dt">alpha =</span> <span class="dv">1</span>, <span class="dt">show_observations =</span> <span class="ot">FALSE</span>, <span class="dt">color=</span><span class="st">"_label_"</span>)</a></code></pre></div>
<p><img src="ceteris_paribus_HR_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
<div id="more-models" class="section level1">
<h1 class="hasAnchor">
<a href="#more-models" class="anchor"></a>More models</h1>
<p>Here we have examples for three classification models: random forest, support vector machines, generalized linear model. We focus only on the ‘fired’ class.</p>
<p>Let’s start with examples for a single observation. We need to train models first. Note that predictions are calculated in a different way for different functions, thus we need to prepare moedl specific predict functions.</p>
<p>Here is for the random forest.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">library</span>(<span class="st">"ceterisParibus"</span>)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="kw">library</span>(<span class="st">"e1071"</span>)</a>
<a class="sourceLine" id="cb9-3" data-line-number="3"></a>
<a class="sourceLine" id="cb9-4" data-line-number="4">model_rf &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/randomForest/topics/randomForest">randomForest</a></span>(status <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>hours <span class="op">+</span><span class="st"> </span>evaluation <span class="op">+</span><span class="st"> </span>salary, <span class="dt">data =</span> HR)</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">pred_rf_fired &lt;-<span class="st"> </span><span class="cf">function</span>(m, x)   <span class="kw">predict</span>(m, x, <span class="dt">type =</span> <span class="st">"prob"</span>)[,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb9-6" data-line-number="6"></a>
<a class="sourceLine" id="cb9-7" data-line-number="7">explainer_rf_fired &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/DALEX/topics/explain">explain</a></span>(model, <span class="dt">data =</span> HR[,<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>], </a>
<a class="sourceLine" id="cb9-8" data-line-number="8">                              <span class="dt">y =</span> HR<span class="op">$</span>status <span class="op">==</span><span class="st"> "fired"</span>, </a>
<a class="sourceLine" id="cb9-9" data-line-number="9">                              <span class="dt">predict_function =</span> pred_rf_fired)</a></code></pre></div>
<p>Here is for generalized linear model.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">model_fired &lt;-<span class="st"> </span><span class="kw">glm</span>(status <span class="op">==</span><span class="st"> "fired"</span> <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>hours <span class="op">+</span><span class="st"> </span>evaluation <span class="op">+</span><span class="st"> </span>salary, <span class="dt">data =</span> HR, <span class="dt">family =</span> <span class="st">"binomial"</span>)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"></a>
<a class="sourceLine" id="cb10-3" data-line-number="3">pred_glm_fired &lt;-<span class="st"> </span><span class="cf">function</span>(m, x)   <span class="kw">predict.glm</span>(m, x, <span class="dt">type =</span> <span class="st">"response"</span>)</a>
<a class="sourceLine" id="cb10-4" data-line-number="4"></a>
<a class="sourceLine" id="cb10-5" data-line-number="5">explainer_glm_fired &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/DALEX/topics/explain">explain</a></span>(model_fired, <span class="dt">data =</span> HR[,<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>], </a>
<a class="sourceLine" id="cb10-6" data-line-number="6">                              <span class="dt">y =</span> HR<span class="op">$</span>status <span class="op">==</span><span class="st"> "fired"</span>, </a>
<a class="sourceLine" id="cb10-7" data-line-number="7">                              <span class="dt">predict_function =</span> pred_glm_fired)</a></code></pre></div>
<p>And here is one for support vector machines.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">model_svm_fired &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/e1071/topics/svm">svm</a></span>(status <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>hours <span class="op">+</span><span class="st"> </span>evaluation <span class="op">+</span><span class="st"> </span>salary, <span class="dt">data =</span> HR, <span class="dt">probability =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"></a>
<a class="sourceLine" id="cb11-3" data-line-number="3">pred_svm_fired &lt;-<span class="st"> </span><span class="cf">function</span>(m, x) <span class="kw">attr</span>(<span class="kw">predict</span>(m, x, <span class="dt">probability =</span> <span class="ot">TRUE</span>), <span class="st">"probabilities"</span>)[,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb11-4" data-line-number="4"></a>
<a class="sourceLine" id="cb11-5" data-line-number="5">explainer_svm_fired &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/DALEX/topics/explain">explain</a></span>(model_svm_fired, <span class="dt">data =</span> HR[,<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>], </a>
<a class="sourceLine" id="cb11-6" data-line-number="6">                              <span class="dt">y =</span> HR<span class="op">$</span>status <span class="op">==</span><span class="st"> "fired"</span>, </a>
<a class="sourceLine" id="cb11-7" data-line-number="7">                              <span class="dt">predict_function =</span> pred_svm_fired)</a></code></pre></div>
<p>Having explainers, we can now create Ceteris Paribus profiles for a selected single observation.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">new_obs &lt;-<span class="st"> </span>HR[<span class="dv">1</span>,]</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"></a>
<a class="sourceLine" id="cb12-3" data-line-number="3">cp_rf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ceteris_paribus.html">ceteris_paribus</a></span>(explainer_rf_fired, new_obs)</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">cp_glm &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ceteris_paribus.html">ceteris_paribus</a></span>(explainer_glm_fired, new_obs)</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">cp_svm &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ceteris_paribus.html">ceteris_paribus</a></span>(explainer_svm_fired, new_obs)</a></code></pre></div>
<p>And we can plot profiles for this observations. Note that both SVM and RF captured the interaction between gender and age. Also they captured the nonlinear relation for salary.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">plot</span>(cp_rf, cp_glm, cp_svm,</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">     <span class="dt">alpha =</span> <span class="fl">0.5</span>, <span class="dt">size_points =</span> <span class="dv">3</span>, <span class="dt">color=</span><span class="st">"_label_"</span>)</a></code></pre></div>
<p><img src="ceteris_paribus_HR_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>Now we can calculate average profile for global explanations. Here the average will be calculated based on 100 observations. Note that since age and gender are in interaction, on average there is no relation between score and the age.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">cp_rf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ceteris_paribus.html">ceteris_paribus</a></span>(explainer_rf_fired, HR[<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>,])</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">cp_glm &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ceteris_paribus.html">ceteris_paribus</a></span>(explainer_glm_fired, HR[<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>,])</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">cp_svm &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ceteris_paribus.html">ceteris_paribus</a></span>(explainer_svm_fired, HR[<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>,])</a>
<a class="sourceLine" id="cb14-4" data-line-number="4"></a>
<a class="sourceLine" id="cb14-5" data-line-number="5"><span class="kw">plot</span>(cp_rf, cp_glm, cp_svm,</a>
<a class="sourceLine" id="cb14-6" data-line-number="6">     <span class="dt">aggregate_profiles =</span> mean, </a>
<a class="sourceLine" id="cb14-7" data-line-number="7">     <span class="dt">alpha =</span> <span class="dv">1</span>, <span class="dt">show_observations =</span> <span class="ot">FALSE</span>, <span class="dt">color=</span><span class="st">"_label_"</span>)</a></code></pre></div>
<p><img src="ceteris_paribus_HR_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
</div>
<div id="cheatsheet" class="section level1">
<h1 class="hasAnchor">
<a href="#cheatsheet" class="anchor"></a>Cheatsheet</h1>
<p>Images and codes used in the cheatsheet</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">percent &lt;-<span class="st"> </span><span class="cf">function</span> (x) </a>
<a class="sourceLine" id="cb15-2" data-line-number="2">    <span class="kw">paste0</span>(<span class="kw">format</span>(<span class="kw">round</span>(x, <span class="dv">2</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>, <span class="dt">big.mark =</span> <span class="st">","</span>, <span class="dt">scientific =</span> <span class="ot">FALSE</span>, <span class="dt">trim =</span> <span class="ot">TRUE</span>), <span class="st">"%"</span>)</a>
<a class="sourceLine" id="cb15-3" data-line-number="3"></a>
<a class="sourceLine" id="cb15-4" data-line-number="4">data_<span class="dv">1</span> &lt;-<span class="st"> </span>HR[<span class="dv">1</span>,]</a>
<a class="sourceLine" id="cb15-5" data-line-number="5">cp_rf3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ceteris_paribus.html">ceteris_paribus</a></span>(explainer_rf_promoted, data_<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb15-6" data-line-number="6"></a>
<a class="sourceLine" id="cb15-7" data-line-number="7"><span class="kw">plot</span>(cp_rf3, </a>
<a class="sourceLine" id="cb15-8" data-line-number="8">     <span class="dt">alpha =</span> <span class="fl">0.5</span>, <span class="dt">size_points =</span> <span class="dv">4</span>, <span class="dt">selected_variables =</span> <span class="st">"hours"</span>, </a>
<a class="sourceLine" id="cb15-9" data-line-number="9">     <span class="dt">as.gg =</span> <span class="ot">TRUE</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">""</span>) <span class="op">+</span><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dt">name =</span> <span class="st">"Pr(promoted)"</span>, <span class="dt">labels =</span>percent) <span class="op">+</span><span class="st"> </span><span class="kw">theme_light</span>()</a></code></pre></div>
<p><img src="ceteris_paribus_HR_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">cp_rf1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ceteris_paribus.html">ceteris_paribus</a></span>(explainer_rf_fired, HR[<span class="dv">1</span>,])</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">cp_rf2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ceteris_paribus.html">ceteris_paribus</a></span>(explainer_rf_ok, HR[<span class="dv">1</span>,])</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">cp_rf3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ceteris_paribus.html">ceteris_paribus</a></span>(explainer_rf_promoted, HR[<span class="dv">1</span>,])</a>
<a class="sourceLine" id="cb16-4" data-line-number="4"></a>
<a class="sourceLine" id="cb16-5" data-line-number="5"><span class="kw">plot</span>(cp_rf1, cp_rf2, cp_rf3, </a>
<a class="sourceLine" id="cb16-6" data-line-number="6">     <span class="dt">alpha =</span> <span class="fl">0.5</span>, <span class="dt">color=</span><span class="st">"_label_"</span>, <span class="dt">size_points =</span> <span class="dv">4</span>, <span class="dt">selected_variables =</span> <span class="st">"hours"</span>, </a>
<a class="sourceLine" id="cb16-7" data-line-number="7">     <span class="dt">as.gg =</span> <span class="ot">TRUE</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">""</span>) <span class="op">+</span><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dt">name =</span> <span class="st">"Pr(promoted)"</span>, <span class="dt">labels =</span> percent) <span class="op">+</span><span class="st"> </span><span class="kw">theme_light</span>() <span class="op">+</span><span class="st"> </span><span class="kw">scale_color_discrete</span>(<span class="dt">name =</span> <span class="st">"class"</span>)</a></code></pre></div>
<p><img src="ceteris_paribus_HR_files/figure-html/unnamed-chunk-14-2.png" width="700"></p>
</div>
<div id="session-info" class="section level1">
<h1 class="hasAnchor">
<a href="#session-info" class="anchor"></a>Session info</h1>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">sessionInfo</span>()</a></code></pre></div>
<pre><code>## R version 3.5.0 (2018-04-23)
## Platform: x86_64-apple-darwin15.6.0 (64-bit)
## Running under: macOS Sierra 10.12.6
## 
## Matrix products: default
## BLAS: /Library/Frameworks/R.framework/Versions/3.5/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/3.5/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] e1071_1.6-8          ceterisParibus_0.3.0 gower_0.1.2         
## [4] ggplot2_3.0.0        randomForest_4.6-14  DALEX_0.2.4         
## 
## loaded via a namespace (and not attached):
##  [1] splines_3.5.0      gtools_3.5.0       shiny_1.1.0       
##  [4] assertthat_0.2.0   expm_0.999-2       sp_1.2-7          
##  [7] highr_0.6          pdp_0.6.0          yaml_2.1.19       
## [10] LearnBayes_2.15.1  pillar_1.2.3       backports_1.1.2   
## [13] lattice_0.20-35    glue_1.2.0         digest_0.6.15     
## [16] promises_1.0.1     colorspace_1.3-2   htmltools_0.3.6   
## [19] httpuv_1.4.3       Matrix_1.2-14      plyr_1.8.4        
## [22] klaR_0.6-14        pkgconfig_2.0.1    breakDown_0.1.6   
## [25] questionr_0.6.2    gmodels_2.16.2     purrr_0.2.5       
## [28] xtable_1.8-2       mvtnorm_1.0-7      scales_0.5.0      
## [31] gdata_2.18.0       later_0.7.2        proxy_0.4-22      
## [34] tibble_1.4.2       combinat_0.0-8     ggpubr_0.1.7      
## [37] withr_2.1.2        ALEPlot_1.1        agricolae_1.2-8   
## [40] lazyeval_0.2.1     survival_2.41-3    magrittr_1.5      
## [43] crayon_1.3.4       mime_0.5           deldir_0.1-15     
## [46] memoise_1.1.0      evaluate_0.10.1    fs_1.2.2          
## [49] nlme_3.1-137       MASS_7.3-49        class_7.3-14      
## [52] xml2_1.2.0         tools_3.5.0        stringr_1.3.1     
## [55] munsell_0.4.3      cluster_2.0.7-1    bindrcpp_0.2.2    
## [58] compiler_3.5.0     pkgdown_1.0.0      rlang_0.2.1       
## [61] grid_3.5.0         rstudioapi_0.7     miniUI_0.1.1.1    
## [64] labeling_0.3       rmarkdown_1.10     boot_1.3-20       
## [67] gtable_0.2.0       roxygen2_6.0.1     reshape2_1.4.3    
## [70] R6_2.2.2           AlgDesign_1.1-7.3  gridExtra_2.3     
## [73] yaImpute_1.0-29    knitr_1.20         dplyr_0.7.6       
## [76] bindr_0.1.1        commonmark_1.5     factorMerger_0.3.6
## [79] rprojroot_1.3-2    spdep_0.7-7        desc_1.2.0        
## [82] stringi_1.2.3      Rcpp_0.12.17       spData_0.2.8.3    
## [85] tidyselect_0.2.4   coda_0.19-1</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#multiclass">Multiclass</a></li>
      <li><a href="#individial-curves">Individial curves</a></li>
      <li><a href="#partial-dependency-plots">Partial Dependency Plots</a></li>
      <li><a href="#partial-dependency-plots-for-groups-of-obervations">Partial Dependency Plots for groups of obervations</a></li>
      <li><a href="#more-models">More models</a></li>
      <li><a href="#cheatsheet">Cheatsheet</a></li>
      <li><a href="#session-info">Session info</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Przemyslaw Biecek.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
